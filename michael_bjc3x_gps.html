<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Snap! Build Your Own Blocks</title>
        <link rel="shortcut icon" href="favicon.ico">

        <link rel="stylesheet" type="text/css" href="AG_status_bar.css" />
        <link rel="stylesheet" type="text/css" href="hintstyle.css" />

        <script src="jschannel.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

        <script src="underscore-min.js"></script>
        <script src='spriteEventLog.js'></script>
        <script src='scriptAnalysis.js'></script>

        <!-- Snap JS Files-->
        <script src="FileSaver.min.js"></script>
        <script src="morphic.js"></script>
        <script src="widgets.js"></script>
        <script src="blocks.js"></script>
        <script src="threads.js"></script>
        <script src="objects.js"></script>
        <script src="gui.js"></script>
        <script src="paint.js"></script>
        <script src="lists.js"></script>
        <script src="byob.js"></script>
        <script src="xml.js"></script>
        <script src="store.js"></script>
        <script src="locale.js"></script>
        <script src="cloud.js"></script>
        <script src="sha512.js"></script>
        <script src="snap-edx-overrides.js"></script>

        <script src="AGAgent.js"></script>
        <script src='feedbackLog.js'></script>
        <script type='text/javascript'>
        var starter_path = 'GPS Scraping.xml';
        // The id is to act as a course identifier.
        // NOTE: FOR NOW YOU ALSO HAVE TO ADD THE ID TO THE BOTTOM OF THE PAGE.
        var courseID = "BJC.3x";  // e.g. "BJCx"
        // Specify a prerequisite task id, should be null if no such requirement.
        var preReqTaskID = null;
        var preReqID = courseID + preReqTaskID;
        // taskID uniquely identifies the task for saving in browser sessionStorage.
        var taskID = "_M3_W1_L1_T?_E?";
        var id = courseID + taskID;
        var isEDX = isEDXurl();
        // if this question is not meant to be graded, change this flag to false
        var graded = true;
        // to hide feedback for this problem, set this to false
        var showFeedback = true;
        // to allow ability to regrade certain tests, set this to true
        var regradeOn = false
        // var testLog;
        function AGTest(outputLog) {
            var fb = new FeedbackLog(
                world,
                id,
                'Generate a list of coordinates'
            );

            var blockName = "coordinates list from url %"
            var chunk_1 = fb.newChunk('Complete the ' + blockName + ' block.');

            var blockExists_1 = function () {
                return spriteContainsBlock(blockName);
            }

            var tip_1_1 = chunk_1.newTip('Make sure you name your block exactly ' + blockName + ' and place it in the scripting area.',
                'The coordinates block exists.');

            tip_1_1.newAssertTest(
                blockExists_1,
                "Testing if the " + blockName + " block is in the scripting area.",
                "The " + blockName + " block is in the scripting area.",
                "Make sure you name your block exactly " + blockName + " and place it in the scripting area.",
                1);

            var tip_1_2 = chunk_1.newTip(
                'Your block should return a list of coordinates.',
                'Great job! Your block reports a list of coordinates.'
            );
            var inputCSVURL = 'http://bjc.edc.org/bjc-r/cur/programming/4-internet/2-gps-data/GPS-NYC.csv';
            tip_1_2.newIOTest('r',  // testClass
                blockName,          // blockSpec
                inputCSVURL,        // input
                function (output) {
                    // Output should be a list of 2D lists.
                    var expectedLength,
                        type,
                        outLength, item, i;
                    
                    type = Process.prototype.reportTypeOf(output);
                    expectedLength = 223;
                    if (type !== 'list') {
                        tip_1_2.suggestion = 'Your block must return a list,';
                        tip_1_2.suggestion += ' but returned a type "' + type + '".';
                        return false;
                    }
                    outLength = output.length();
                    if (outLength !== expectedLength) {
                        tip_1_2.suggestion = 'You list should have length 223;';
                        tip_1_2.suggestion += ' but was ' + outLength + '.';
                        return false;
                    }
                    // FIXME: Not great if list is linked.
                    for (i = 1; i <= outLength; i+= 1) {
                        item = output.at(i);
                        if (Process.prototype.reportTypeOf(item) !== 'list') {
                            tip_1_2.suggestion = 'Item ' + i + ' should be a list.';
                            return false;
                        }
                        if (item.length() !== 2) {
                            tip_1_2.suggestion = 'Item ' + i + ' should have 2 items.';
                            return false;
                        }
                        console.log(Process.prototype.reportTypeOf(item.at(1)));
                        console.log(Process.prototype.reportTypeOf(item.at(2)));
                    }
                    return true;
                },
                4 * 1000 // 4 second time out.
            );

            return fb;
        }
        </script>
        <script src="AGFormatting.js"></script>

        <script>
        var world, world_canvas;
        window.onload = function () {
            var ide, grade_button;
            // INITIALIZE SNAP
            world_canvas = document.getElementById('world')
            world = new WorldMorph(world_canvas);
            ide = new IDE_Morph();
            ide.openIn(world);

            // AUTOGRADER ADDITIONS:
            // Set Snap! to small stage mode
            ide.toggleStageSize(true);
            initializeSnapAdditions(world, id);

            // Initialize AGSB button.
            grade_button = document.getElementById("autograding_button");
            grade_button.addEventListener('click', button_listener);
            world_canvas.addEventListener("mouseup", update_listener);
            // Start Snap Environment Loop
            loop();
        };

        function loop() {
            requestAnimationFrame(loop);
            world.doOneCycle();
        }
        </script>
        <script src="AG_EDX.js"></script>
</head>
<body style="margin: 0;">
  <canvas id="world" tabindex="1" style="position: absolute;" ></canvas>

  <!-- Snap Autograding Button -->
  <div id="autograding_bar">
    <div tabindex="0" class="onclick-menu" id='onclick-menu' style="display:inline-block">
      <span title="Menu">&#9776;</span>
      <div class='hover_darken'></div>
      <nav id="navigation" class="site-navigation" role="navigation">
        <ul id="dropdown-closed" class="bubble">
          <li class="menu-item-sub-menu" id="enabled-button">
              <a id="undo-button">Revert To Last Attempt</a>
          </li>
          <li class="menu-item-sub-menu" id="enabled-button">
              <a id="revert-button">Revert To Best Attempt</a>
          </li>
          <li class="menu-item-sub-menu" id="enabled-button">
              <a id="reset-button">Reset</a>
          </li>
          <li class="menu-divider-sub-menu" id='menu-divider'></li>
          <li class="menu-item-sub-menu" id='enabled-button' onclick="openPopup();">
              <a id="help-button">Help</a>
          </li>
        </ul>
      </nav>
    </div>
    <div id="autograding_button" style="display:inline-block;">
      <span></span>
      <div class='hover_darken'></div>
    </div>
    <div id="numtips" style="display:inline-block"></div>
  </div>

  <!-- Snap Autograding Menu -->
  <!-- Autograding Menu Help Button -->
  <div class="overlay is-hidden" id="overlay">
    <p class="help-text" id="full-screen-arrow">&#8600;</p>
    <p class="help-text" id="full-screen-help">This full-screen button will pop out the Snap! window.</p>
    <p class="help-text" id="menu-item-arrow">&#8599;</p>
    <p class="help-text" id="menu-item-help">The first two menu items will revert your current Snap! state to one of your previous attempts, depending on whether you wish to revert to your last graded attempt or to your best attempt.</br></br>The 'Reset' button will revert to a blank Snap! project, or to a provided starter file if one is given for this problem.</p>
    <p class="help-text" id="ag-button-arrow">&#8593;</p>
    <p class="help-text" id="ag-button-help">Clicking this button will grade your current attempt and send the results to edX.</p>
  </div>

  <div style="display:inline-block" class="view-results"
    id="circle" onclick="openResults();">Results
  </div>

  <div class="overlay is-hidden" id="ag-output">
    <div class="popup-content" id="ag-results">
      <span class="button-close" onclick="closeResults();" id="popup">X</span>
      <div id="toggle-correct-tests"></div>
      <p id="comment"></p>
    </div>
  </div>
  </div>

</body>
</html>